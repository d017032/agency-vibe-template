---
// 1. STABLE IMPORTS
import Layout from '../layouts/Layout.astro';
import data from '../data/business.json'; 

import Navbar from '../components/Navbar.astro';
import Hero from '../components/Hero.astro';
import Features from '../components/Features.astro';
import BentoAbout from '../components/BentoAbout.astro';
import Comparison from '../components/Comparison.astro';
import Process from '../components/Process.astro';
import Investment from '../components/Investment.astro';
import Gallery from '../components/Gallery.astro';
import FAQ from '../components/FAQ.astro';
import Contact from '../components/Contact.astro';
import Footer from '../components/Footer.astro';
import Testimonials from '../components/Testimonials.astro';
import VibeSwitcher from '../components/VibeSwitcher.astro';
import Events from '../components/Events.astro';
import ServiceArea from '../components/ServiceArea.astro'; // NEW IMPORT

// 2. DATA MAPPING
const settings = data?.settings || {};
const strategy = data?.layout_strategy || {}; 
const brand = data?.brand || {};
const hero = data?.hero || {};
const about = data?.about || {}; 
const features = data?.features || [];
const comparison = data?.comparison || null;
const processSteps = data?.processSteps || [];
const investment = data?.investment || [];
const gallery = data?.gallery || [];
const faqs = data?.faqs || [];
const contact = data?.contact || {};
const testimonials = data?.testimonials || [];
const events = data?.events || [];
const serviceArea = data?.service_area || null; // NEW MAPPING

// 3. TITLE LOGIC
const siteTitle = brand?.name 
  ? `${brand.name}${brand.tagline ? ' | ' + brand.tagline : ''}`
  : 'Premium Service Site';
---

<Layout title={siteTitle}>
  
  {settings?.menu && (
    <Navbar 
      brand={brand} 
      menu={settings.menu} 
      cta_text={settings.cta_text} 
      cta_link={settings.cta_link} 
    />
  )}
  
  <main>
    {hero?.headline && (
      <Hero id="home" hero={hero} settings={settings} brand={brand} />
    )}

    {strategy.show_events && events.length > 0 && (
      <Events events={events} />
    )}

    {strategy.show_bento_about !== false && about?.story_text && (
      <BentoAbout id="about" brand={brand} hero={hero} about={about} />
    )}

    {features.length > 0 && (
      <Features id="features" features={features} />
    )}

    {/* NEW: SERVICE AREA GATE */}
    {strategy.show_service_area && serviceArea && (
      <ServiceArea data={serviceArea} />
    )}

    {strategy.show_testimonials && testimonials.length > 0 && (
      <Testimonials 
        id="testimonials" 
        testimonials={testimonials} 
        headline={brand?.testimonial_headline || "Voices of Trust"} 
      />
    )}

    {strategy.show_comparison && comparison && (
      <Comparison id="comparison" comparison={comparison} brand={brand} />
    )}

    {strategy.show_process !== false && processSteps.length > 0 && (
      <Process id="process" steps={processSteps} />
    )}

    {strategy.show_gallery && gallery.length > 0 && (
      <Gallery id="gallery" gallery={gallery} />
    )}

    {strategy.show_investment !== false && investment.length > 0 && (
      <Investment id="pricing" tiers={investment} brand={brand} />
    )}

    {strategy.show_faqs && faqs.length > 0 && (
      <FAQ id="faqs" faqs={faqs} />
    )}

    {contact?.email && (
      <Contact id="contact" brand={brand} contact={contact} settings={settings} />
    )}
  </main>

  <Footer brand={brand} />
  <VibeSwitcher />
</Layout>