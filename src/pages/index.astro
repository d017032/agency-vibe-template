---
// 1. STABLE IMPORTS
import Layout from '../layouts/Layout.astro';
import data from '../data/business.json';

import Navbar from '../components/Navbar.astro';
import Hero from '../components/Hero.astro';
import Features from '../components/Features.astro';
import BentoAbout from '../components/BentoAbout.astro';
import Comparison from '../components/Comparison.astro';
import Process from '../components/Process.astro';
import Investment from '../components/Investment.astro';
import Gallery from '../components/Gallery.astro';
import FAQ from '../components/FAQ.astro';
import Contact from '../components/Contact.astro';
import Footer from '../components/Footer.astro';
import VibeSwitcher from '../components/VibeSwitcher.astro';

// 2. DEFENSIVE DATA MAPPING (The Safety Net)
const settings = data?.settings || {};
const brand = data?.brand || {};
const hero = data?.hero || {};
const features = data?.features || [];
const comparison = data?.comparison || null;
const processSteps = data?.processSteps || [];
const investment = data?.investment || [];
const gallery = data?.gallery || [];
const faqs = data?.faqs || [];
const contact = data?.contact || {};

// 3. TITLE LOGIC
const siteTitle = brand?.name 
  ? `${brand.name}${brand.tagline ? ' | ' + brand.tagline : ''}`
  : 'Premium Service Site';
---

<Layout title={siteTitle}>
  
  {/* NAVBAR: Only render if settings exists */}
  {settings?.menu && (
    <Navbar 
      brand={brand} 
      menu={settings.menu} 
      cta_text={settings.cta_text} 
      cta_link={settings.cta_link} 
    />
  )}
  
  <main>
    {/* HERO: Guarded by headline existence */}
    {hero?.headline && (
      <Hero id="home" hero={hero} settings={settings} brand={brand} />
    )}

    {/* ABOUT: Guarded by brand name */}
    {brand?.name && (
      <BentoAbout id="about" brand={brand} hero={hero} />
    )}

    {/* FEATURES: Guarded by array length */}
    {features.length > 0 && (
      <Features id="features" features={features} />
    )}

    {/* COMPARISON: Guarded by object existence */}
    {comparison && (
      <Comparison id="comparison" comparison={comparison} brand={brand} />
    )}

    {/* PROCESS: Guarded by array length */}
    {processSteps.length > 0 && (
      <Process id="process" steps={processSteps} />
    )}

    {/* GALLERY: Guarded by array length */}
    {gallery.length > 0 && (
      <Gallery id="gallery" gallery={gallery} />
    )}

    {/* Use id="pricing" to match what the AI puts in menu paths */}
    {investment && investment.length > 0 && (
      <Investment 
        id="pricing" 
        tiers={investment} 
        brand={brand} 
      />
    )}

    {/* FAQ: Guarded by array length */}
    {faqs.length > 0 && (
      <FAQ id="faqs" faqs={faqs} />
    )}

    {/* CONTACT: Guarded by email existence */}
    {contact?.email && (
      <Contact id="contact" brand={brand} contact={contact} settings={settings} />
    )}
  </main>

  <Footer brand={brand} />
  
  {/* Dev Tool: Persistent Vibe Switcher */}
  <VibeSwitcher />

</Layout>