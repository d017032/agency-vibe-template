---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro'; // ADDED MISSING IMPORT
import Hero from '../components/Hero.astro';
import BentoAbout from '../components/BentoAbout.astro';
import Features from '../components/Features.astro';
import Process from '../components/Process.astro';
import Testimonials from '../components/Testimonials.astro';
import Comparison from '../components/Comparison.astro';
import Gallery from '../components/Gallery.astro';
import Investment from '../components/Investment.astro';
import FAQ from '../components/FAQ.astro';
import Contact from '../components/Contact.astro';
import ServiceArea from '../components/ServiceArea.astro';

import data from '../data/business.json';

/** * 2026 DATA DESTRUCTURING - SCHEMA ALIGNED
 */
const {
  intelligence = {},
  strategy = {},
  settings = {}, // Holds vibe and menu
  brand = {},
  about = {},
  hero = {},
  features = [],
  processSteps = [],
  testimonials = [],
  comparison = null,
  gallery = null,
  investment = [],
  faqs = [],
  service_area = [],
  contact = {}
} = data;

// FIX: Extract menu from settings per Master Schema
const navMenu = settings.menu || [];

const siteTitle = brand.name ? `${brand.name} | ${brand.tagline || 'Professional Services'}` : "Vibe-Engine Production";
---

<Layout title={siteTitle} settings={settings}>
  
  <Navbar brand={brand} menu={navMenu} settings={settings} />  

  <main>
    {/* 1. HERO SECTION */}
    <Hero hero={hero} brand={brand} settings={settings} />

    {/* 1.5 THE BENTO ABOUT */}
    {strategy.show_about !== false && (brand.name || about.story_text) && (
      <BentoAbout 
        brand={brand} 
        about={about} 
        intelligence={intelligence}
      />
    )}

    {/* 2. FEATURES / SERVICES */}
    {strategy.show_features && features.length > 0 && (
      <Features features={features} intelligence={intelligence} />
    )}

    {/* 3. METHODOLOGY / PROCESS */}
    {strategy.show_process && processSteps.length > 0 && (
      <Process steps={processSteps} intelligence={intelligence} />
    )}

    {/* 4. SOCIAL PROOF */}
    {strategy.show_testimonials && testimonials.length > 0 && (
      <Testimonials testimonials={testimonials} />
    )}

    {/* 5. VALUE COMPARISON */}
    {strategy.show_comparison && comparison && (
      <Comparison comparison={comparison} intelligence={intelligence} />
    )}

    {/* 6. PORTFOLIO / GALLERY */}
    {strategy.show_gallery && gallery?.enabled !== false && gallery?.items?.length > 0 && (
      <Gallery gallery={gallery} brand={brand} />
    )}
    

    {/* 7. PRICING / INVESTMENT */}
    {strategy.show_investment && investment.length > 0 && (
      <Investment tiers={investment} brand={brand} />
    )}

    {/* 8. OBJECTION HANDLING */}
    {strategy.show_faqs && faqs.length > 0 && (
      <FAQ faqs={faqs} />
    )}

    {/* 8.5 SERVICE AREA (The Final Local Trust Check) */}
    {strategy.show_service_area && data.service_area && (
      <ServiceArea 
        service_area={data.service_area} 
        intelligence={intelligence} 
      />
    )}

    {/* 9. FINAL CONVERSION */}
    <Contact contact={contact} intelligence={intelligence} brand={brand} settings={settings} />
  </main>

</Layout>