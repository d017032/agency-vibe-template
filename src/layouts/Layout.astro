---
/**
 * Main Layout - 2026 High-Performance Vibe Engine
 * Strategy: Hybrid (CSS Structure + JS Variable Injection)
 * Goal: Custom Agency Quality at AI Speed
 */
 import data from '../data/business.json';
import '../styles/vibe-system.css';

interface Props {
    title?: string;
    vibeOverride?: string;
}

const { title, vibeOverride } = Astro.props;

// 1. VIBE NORMALIZATION (Maintains your established slug system)
const rawVibe = vibeOverride || data.settings?.vibe || 'midnight-tech';
const activeVibe = rawVibe.toLowerCase().replace(/\s+/g, '-');

// 2. THE VIBE LIBRARY (Agency-Grade Presets)
const vibeLibrary = {
  'midnight-tech': {
    accent: '#00f2ff',      // Neon Cyan
    bg: '#020617',          // Deep Space Navy
    text: '#f8fafc',        // Ghost White
    radius: '4px',
    font: "'JetBrains Mono', monospace"
  },
  'zenith-earth': {
    accent: '#10b981',      // Emerald Green
    bg: '#f0fdf4',          // Mint Cream
    text: '#064e3b',        // Deep Forest
    radius: '24px',
    font: "'Outfit', sans-serif"
  },
  'vintage-boutique': {
    accent: '#b45309',      // Polished Gold
    bg: '#fffbeb',          // Warm Ivory
    text: '#451a03',        // Espresso
    radius: '12px',
    font: "'Cormorant Garamond', serif"
  },
  'rugged-industrial': {
    accent: '#f97316',      // Safety Orange
    bg: '#000000',          // Pure Black
    text: '#ffffff',
    radius: '0px',
    font: "'Inter', sans-serif"
  },
  'modern-minimal': {
    accent: '#6366f1',      // Indigo
    bg: '#ffffff',          // Pure White
    text: '#1e293b',        // Slate
    radius: '8px',
    font: "'Inter', sans-serif"
  },
  'luxury-noir': {
    accent: '#D4AF37',      // Metallic Gold
    bg: '#050505',          // Pure Rich Black
    text: '#ffffff',        // White
    radius: '2px',          // Sharp, premium edges
    font: "'Cormorant Garamond', serif"
  },
};

const config = vibeLibrary[activeVibe] || vibeLibrary['midnight-tech'];

// 3. SEO & SCHEMA (Untouched to prevent breaking your metadata)
const seoTitle = title || `${data.brand.name} | ${data.brand.tagline}`;
const ldJson = {
  "@context": "https://schema.org",
  "@type": data.intelligence?.industry?.includes('Music') ? "EventVenue" : "LocalBusiness",
  "name": data.brand.name,
  "description": data.brand.tagline,
  "image": `/images/${data.hero?.image?.src}`
};
---

<!doctype html>
<html lang="en" data-vibe={activeVibe}>
    <head>
        <meta charset="UTF-8" />
        <meta name="description" content={data.brand.objection_handle} />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <title>{seoTitle}</title>

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link 
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@400;800&family=Cormorant+Garamond:ital,wght@0,400;0,700;1,700&family=Outfit:wght@400;900&display=swap" 
            rel="stylesheet" 
        />

        <script type="application/ld+json" set:html={JSON.stringify(ldJson)} />

        <style define:vars={{ 
            'v-accent': config.accent,
            'v-bg': config.bg,
            'v-text': config.text,
            'v-radius': config.radius,
            'v-font': config.font
        }}>
            :root {
                --accent: var(--v-accent);
                --bg-color: var(--v-bg);
                --text-primary: var(--v-text);
                --radius: var(--v-radius);
                --font-main: var(--v-font);
                
                /* Computed variables: 90/10 mix removes the "Gray" feeling */
                --bg-card: color-mix(in srgb, var(--bg-color) 90%, var(--accent));
                --border: color-mix(in srgb, var(--accent) 25%, transparent);
                --text-secondary: color-mix(in srgb, var(--text-primary) 70%, transparent);
            }
        </style>
    </head>
    <body class="bg-[var(--bg-color)] text-[var(--text-primary)] font-[var(--font-main)] transition-colors duration-500 selection:bg-[var(--accent)] selection:text-[var(--bg-color)]">
        <slot />
        
        <style is:global>
            html { scroll-behavior: smooth; }
            
            /* Global Font Override to ensure the Vibe Library font wins */
            body { font-family: var(--font-main) !important; }

            /* Professional Agency Heading Style */
            h1, h2, h3, h4, .brand-heading {
                font-weight: 900;
                letter-spacing: -0.04em;
                text-transform: uppercase;
                line-height: 0.9;
            }

            /* Fix for images to ensure they match the vibe's radius */
            img, .vibe-container {
                border-radius: var(--radius);
            }
        </style>
    </body>
</html>