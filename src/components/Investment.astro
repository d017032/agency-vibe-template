---
import { iconLibrary } from '../lib/icons.js';
const { tiers, id, brand } = Astro.props;

// Get the main section icon from the library
const sectionIconPath = iconLibrary[brand?.investment_icon] || iconLibrary.coins;
---

<section id={id} class="py-24 px-6 bg-[var(--bg-color)] border-t border-[var(--border)] scroll-mt-24">
  <div class="max-w-6xl mx-auto">
    <div class="text-center mb-16">
      <div class="inline-flex items-center justify-center w-14 h-14 rounded-full border border-[var(--border)] mb-6 text-[var(--accent)] bg-[var(--bg-color)] feature-icon-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d={sectionIconPath} />
        </svg>
      </div>
      
      <h2 class="text-4xl md:text-7xl font-black uppercase tracking-tighter text-[var(--text-primary)]">
        {brand?.investment_headline || "Pricing"}
      </h2>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      {tiers && tiers.map((tier: any) => (
        <div class="flex flex-col p-8 border border-[var(--border)] rounded-[var(--radius)] bg-[var(--bg-color)] hover:border-[var(--accent)] transition-all duration-300 group shadow-sm">
          <h3 class="text-xs font-bold uppercase tracking-[0.2em] text-[var(--accent)] mb-2">{tier.name}</h3>
          <div class="text-5xl font-black text-[var(--text-primary)] mb-6 tracking-tighter">
            {tier.price}
          </div>
          
          <ul class="flex-grow space-y-4 mb-10">
            {tier.features && tier.features.map((feature: string) => {
              // DETECT \ICON PATTERN
              const match = feature.match(/^\\(\w+)\s*(.*)/);
              const iconKey = match ? match[1].toLowerCase() : null;
              const cleanText = match ? match[2] : feature;
              const path = iconLibrary[iconKey];

              return (
                <li class="text-sm text-[var(--text-secondary)] flex items-start gap-3">
                  <span class="text-[var(--accent)] mt-1 shrink-0">
                    {path ? (
                      /* Renders the specific icon from our library */
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d={path}/>
                      </svg>
                    ) : (
                      /* Fallback to arrow if no backslash or icon not found */
                      "â†’"
                    )}
                  </span>
                  <span class="leading-tight">{cleanText}</span>
                </li>
              );
            })}
          </ul>

          <a href="#contact" class="w-full text-center py-4 border border-[var(--text-primary)] text-[var(--text-primary)] hover:bg-[var(--text-primary)] hover:text-[var(--bg-color)] text-[10px] font-bold uppercase tracking-[0.2em] rounded-[var(--radius)] transition-all active:scale-95">
            {tier.cta || "Get Started"}
          </a>
        </div>
      ))}
    </div>
  </div>
</section>